<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Rewarded Ad Demo</title>
  <style>
    button { padding: 10px 16px; margin: 6px; }
    #status { margin-top: 10px; font-family: Arial, sans-serif; }
  </style>
  <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
  <script>
    window.googletag = window.googletag || {cmd: []};

    let rewardedSlot = null;
    let rewardedReady = false;

    googletag.cmd.push(function() {
      // Replace with your Ad Manager ad unit path
      const adUnitPath = "/1234567/my_rewarded_unit";

      // Define a rewarded out-of-page slot
      rewardedSlot = googletag.defineOutOfPageSlot(
        adUnitPath,
        googletag.enums.OutOfPageFormat.REWARDED
      );

      if (rewardedSlot) {
        rewardedSlot.addService(googletag.pubads());

        // Reward callbacks
        googletag.pubads().addEventListener('rewardedSlotReady', function(event) {
          if (event.slot === rewardedSlot) {
            rewardedReady = true;
            setStatus("Rewarded ad is ready. Click 'Show Rewarded Ad'.");
          }
        });

        googletag.pubads().addEventListener('rewardedSlotClosed', function(event) {
          if (event.slot === rewardedSlot) {
            setStatus("Ad closed. You can grant reward here.");
            // TODO: Grant reward to the user in your app logic
            // After showing once, you typically need to load again
            rewardedReady = false;
          }
        });

        googletag.pubads().addEventListener('slotRenderEnded', function(event) {
          if (event.slot === rewardedSlot && event.isEmpty) {
            setStatus("No fill: no rewarded ad available right now.");
          }
        });

        googletag.enableServices();
      } else {
        setStatus("Failed to create rewarded slot. Check ad unit path and GAM setup.");
      }
    });

    function loadRewarded() {
      rewardedReady = false;
      setStatus("Loading rewarded ad...");
      googletag.cmd.push(function() {
        googletag.pubads().refresh([rewardedSlot]);
      });
    }

    function showRewarded() {
      if (!rewardedReady) {
        setStatus("Ad not ready yet. Click 'Load Rewarded Ad' first.");
        return;
      }
      setStatus("Showing rewarded ad...");
      googletag.cmd.push(function() {
        rewardedSlot && rewardedSlot.show();
      });
    }

    function setStatus(msg) {
      document.getElementById('status').innerText = msg;
    }
  </script>
</head>
<body>
  <h3>Rewarded Ad Demo</h3>
  <button onclick="loadRewarded()">Load Rewarded Ad</button>
  <button onclick="showRewarded()">Show Rewarded Ad</button>
  <div id="status">Idle</div>
</body>
</html>
